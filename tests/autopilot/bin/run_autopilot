#!/usr/bin/env python

import os
import sys
import junitxml
from argparse import ArgumentParser
from unittest.loader import TestLoader
from unittest.runner import TextTestRunner

if __name__ == "__main__":
	parser = ArgumentParser()
        parser.add_argument('-o', "--output", required=False, help='Write test result report to file. Defaults to stdout')
	args = parser.parse_args()

	if args.output == None:
		results_stream = sys.stdout
	else:
		path = os.path.dirname(args.output)
		if not (os.path.exists(path) or path==''):
			os.makedirs(path)
		results_stream = open(args.output, 'w')

	loader = TestLoader()
	result = junitxml.JUnitXmlResult(results_stream)
	result.startTestRun()
	test_suite = loader.discover('autopilot.tests')
	test_suite.run(result)
	result.stopTestRun()
	results_stream.close()
